<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <script src="js/qqv34.js"></script>
  <script type="module" src="js/console.js"></script>
</head>
<body>
<script type="module">

import {m,butonsEditPanel,bottomPanel} from 'https://slachinov.github.io/Lib/pan/main.js';


import {} from 'https://slachinov.github.io/Editor/buttonsEdit.js';
//==
import {} from 'https://slachinov.github.io/Editor/panelLs.V1.js';

//=== Editor/panelLs.V1.js


//======
export default function LsCreateLocalStoragePanel55(par = {}) {


  let m = par.m;
  let edit = par.edit || m.edit;


  const Skin = {
    styleButt: { fontSize: '20px', margin: '2px' },
    styleInp: { fontSize: '20px', margin: '2px' }
  };


let skinButt = qq.cs(Skin.styleButt, par.skinbutt || {});
let skinInp  = qq.cs(Skin.styleInp,  par.skininp  || {});


  // контейнер
  let container = qq.ce({ tag: 'div', parent: m.topPanel });


  // Ls метка
  qq.ce({
    tag: 'span',
    parent: container,
    it: 'ls55',
    style: { color: 'magenta', background:'white', marginRight: '6px', fontSize: '16px' }
  });


  // кнопка очистки инпута
  qq.ce({
    tag: 'button',
    it: 'CL',
    parent: container,
    style: skinButt,
    event: { click() { keyInput.value=''; } }
  });


  // input key (используется и для поиска)
  let keyInput = qq.ce({
    tag: 'input',
    parent: container,
    attr: { type: 'text', placeholder: 'Введите ключ localStorage / поиск' },
    style: skinInp
  });


  // Load
  qq.ce({
    tag: 'button',
    it: 'Load',
    parent: container,
    style: skinButt,
    event: {
      click() {
        let key = keyInput.value.trim();
        if (!key) return;
        let value = localStorage.getItem(key);
        edit.innerText = value!==null?value:'';
        if(value===null) qq.cl(`Нет значения: "${key}"`);
      }
    }
  });


  // Save красный
  qq.ce({
    tag: 'button',
    it: 'Save',
    parent: container,
    style: { ...skinButt, background:'red', color:'white' },
    event: {
      click() {
        let key = keyInput.value.trim();
        if(!key) return;
        localStorage.setItem(key, edit.innerText);
        qq.cl(`Сохранено: "${key}"`);
      }
    }
  });


  // Delete красный
  qq.ce({
    tag: 'button',
    it: 'Delete',
    parent: container,
    style: { ...skinButt, background:'red', color:'white' },
    event: {
      click() {
        let key = keyInput.value.trim();
        if(!key) return;
        localStorage.removeItem(key);
        edit.innerText='';
        qq.cl(`Удалено: "${key}"`);
      }
    }
  });


  // checkbox для поиска
  let searchCheckbox = qq.ce({
    tag:'input',
    parent: container,
    attr:{ type:'checkbox' }
  });
  // после checkbox пока ничего не пишем


  // кнопка Search (используем тот же input)
  qq.ce({
    tag:'button',
    it:'Search',
    parent: container,
    style: skinButt,
    event:{
      click(){
        let query = keyInput.value.trim().toLowerCase();
        if(!query) return;


        let keys = [];
        for(let i=0;i<localStorage.length;i++){
          let key = localStorage.key(i);
          let value = localStorage.getItem(key);
          if(!searchCheckbox.checked && key.toLowerCase().includes(query)) keys.push(key);
          if(searchCheckbox.checked && value && value.toLowerCase().includes(query)) keys.push(key);
        }


        keys.sort((a,b)=>a.localeCompare(b));
        renderLSItems(keys);
      }
    }
  });


  // кнопка All
  qq.ce({
    tag:'button',
    it:'All',
    parent: container,
    style: skinButt,
    event:{
      click(){
        let keys = [];
        for(let i=0;i<localStorage.length;i++) keys.push(localStorage.key(i));
        keys.sort((a,b)=>a.localeCompare(b));
        renderLSItems(keys);
      }
    }
  });


  // функция рендера элементов на панели all
  function renderLSItems(keys){
if(!keys || keys.length===0) return;
    m.all.innerHTML='';
    m.all.show();
    for(let key of keys){
      let value = localStorage.getItem(key);
      qq.ce({
        tag:'div',
        parent: m.all,
        it:key,
        style:{ border:'1px solid black', padding:'2px', margin:'2px' },
        event:{
          click(){
            keyInput.value = key;
            edit.innerText = value;
            m.all.hide();
          }
        }
      });
    }
  }


  return container;
}
</script>
<script>alert(8);</script>
</body>
</html>