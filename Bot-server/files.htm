<!DOCTYPE html>
<html lang="ru">
<head>
Â  <meta charset="UTF-8">
Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  <title>gihub files</title>
<script src="../js/qqv33.js"></script>
Â  </head>
<body>125
<script type='module'>alert(2);
alert(qq.ca);
qq.ca([{tag:'div',style:{top:'0px',left:'0px',right:'0px',bottom:'0px',background:'gray',position: 'absolute','z-index':5},name:'main'}]);


</script>
let token = localStorage.getItem('bot-token');
let repo = 'user/repo'; /* Ð·Ð°Ð¼ÐµÐ½Ð¸Ñ‚Ðµ Ð½Ð° ÑÐ²Ð¾Ð¹ repo, Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€: myname/myrepo */


let app = qq.ca('githubApp', {
Â  skin: [
Â  Â  { ns: 'githubApp', tag: 'div', style: { padding: '1em', fontFamily: 'sans-serif' } },


Â  Â  /* Ð’Ð²Ð¾Ð´ Ð¿ÑƒÑ‚Ð¸ */
Â  Â  { tag: 'input', ns: 'path', attr: { placeholder: 'ÐŸÑƒÑ‚ÑŒ (Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€: files/)' }, prop: { value: 'files/' }, style: { width: '100%', marginBottom: '0.5em' } },


Â  Â  /* Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° ÑÐ¿Ð¸ÑÐºÐ° Ñ„Ð°Ð¹Ð»Ð¾Ð² */
Â  Â  { tag: 'button', ns: 'load', innerText: 'ðŸ“‚ Ð—Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚ÑŒ ÑÐ¿Ð¸ÑÐ¾Ðº Ñ„Ð°Ð¹Ð»Ð¾Ð²', style: { marginBottom: '1em' }, event: {
Â  Â  Â  tap: async function () {
Â  Â  Â  Â  let path = app.path.value.trim();
Â  Â  Â  Â  if (!path) return alert('Ð£ÐºÐ°Ð¶Ð¸ Ð¿ÑƒÑ‚ÑŒ');
Â  Â  Â  Â  let url = `https://api.github.com/repos/${repo}/contents/${path}`;


Â  Â  Â  Â  let res = await fetch(url, {
Â  Â  Â  Â  Â  headers: { Authorization: `token ${token}` }
Â  Â  Â  Â  });
Â  Â  Â  Â  let files = await res.json();


Â  Â  Â  Â  if (!Array.isArray(files)) return alert('Ð­Ñ‚Ð¾ Ð½Ðµ Ð¿Ð°Ð¿ÐºÐ° Ð¸Ð»Ð¸ Ð¾ÑˆÐ¸Ð±ÐºÐ°');


Â  Â  Â  Â  app.list.innerHTML = '';
Â  Â  Â  Â  for (let file of files) {
Â  Â  Â  Â  Â  if (file.type === 'file') {
Â  Â  Â  Â  Â  Â  app.list.appendChild(qq.ce({
Â  Â  Â  Â  Â  Â  Â  tag: 'button', innerText: file.name, style: { display: 'block', margin: '2px 0' },
Â  Â  Â  Â  Â  Â  Â  event: {
Â  Â  Â  Â  Â  Â  Â  Â  tap: async () => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  let res2 = await fetch(file.download_url);
Â  Â  Â  Â  Â  Â  Â  Â  Â  let txt = await res2.text();
Â  Â  Â  Â  Â  Â  Â  Â  Â  app.filename.value = file.path;
Â  Â  Â  Â  Â  Â  Â  Â  Â  app.content.value = txt;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }));
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  }
Â  Â  }},


Â  Â  { tag: 'div', ns: 'list', style: { marginBottom: '1em' } },


Â  Â  /* Ð˜Ð¼Ñ Ñ„Ð°Ð¹Ð»Ð° */
Â  Â  { tag: 'input', ns: 'filename', attr: { placeholder: 'Ð˜Ð¼Ñ Ñ„Ð°Ð¹Ð»Ð° (Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€: files/test.txt)' }, style: { width: '100%', marginBottom: '0.5em' } },


Â  Â  /* Ð§Ñ‚ÐµÐ½Ð¸Ðµ Ñ„Ð°Ð¹Ð»Ð° */
Â  Â  { tag: 'button', innerText: 'ðŸ“– ÐŸÑ€Ð¾Ñ‡Ð¸Ñ‚Ð°Ñ‚ÑŒ Ñ„Ð°Ð¹Ð»', style: { marginBottom: '0.5em' }, event: {
Â  Â  Â  tap: async function () {
Â  Â  Â  Â  let path = app.filename.value.trim();
Â  Â  Â  Â  if (!path) return alert('Ð£ÐºÐ°Ð¶Ð¸ Ð¸Ð¼Ñ Ñ„Ð°Ð¹Ð»Ð°');
Â  Â  Â  Â  let url = `https://api.github.com/repos/${repo}/contents/${path}`;


Â  Â  Â  Â  let res = await fetch(url, {
Â  Â  Â  Â  Â  headers: { Authorization: `token ${token}` }
Â  Â  Â  Â  });
Â  Â  Â  Â  let data = await res.json();
Â  Â  Â  Â  if (data.content) {
Â  Â  Â  Â  Â  let decoded = decodeURIComponent(escape(atob(data.content)));
Â  Â  Â  Â  Â  app.content.value = decoded;
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  alert('ÐžÑˆÐ¸Ð±ÐºÐ°: ' + data.message);
Â  Â  Â  Â  }
Â  Â  Â  }
Â  Â  }},


Â  Â  /* ÐšÐ¾Ð½Ñ‚ÐµÐ½Ñ‚ Ñ„Ð°Ð¹Ð»Ð° */
Â  Â  { tag: 'textarea', ns: 'content', attr: { placeholder: 'Ð¡Ð¾Ð´ÐµÑ€Ð¶Ð¸Ð¼Ð¾Ðµ Ñ„Ð°Ð¹Ð»Ð°...' }, style: { width: '100%', height: '150px', marginBottom: '0.5em' } },


Â  Â  /* Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ðµ Ñ„Ð°Ð¹Ð»Ð° */
Â  Â  { tag: 'button', innerText: 'ðŸ’¾ Ð¡Ð¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ Ñ„Ð°Ð¹Ð»', event: {
Â  Â  Â  tap: async function () {
Â  Â  Â  Â  let path = app.filename.value.trim();
Â  Â  Â  Â  let content = app.content.value;
Â  Â  Â  Â  if (!path) return alert('Ð£ÐºÐ°Ð¶Ð¸ Ð¸Ð¼Ñ Ñ„Ð°Ð¹Ð»Ð°');


Â  Â  Â  Â  let getSha = async () => {
Â  Â  Â  Â  Â  let res = await fetch(`https://api.github.com/repos/${repo}/contents/${path}`, {
Â  Â  Â  Â  Â  Â  headers: { Authorization: `token ${token}` }
Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  let data = await res.json();
Â  Â  Â  Â  Â  return data.sha || undefined;
Â  Â  Â  Â  };


Â  Â  Â  Â  let sha = await getSha();
Â  Â  Â  Â  let encoded = btoa(unescape(encodeURIComponent(content)));


Â  Â  Â  Â  let res = await fetch(`https://api.github.com/repos/${repo}/contents/${path}`, {
Â  Â  Â  Â  Â  method: 'PUT',
Â  Â  Â  Â  Â  headers: {
Â  Â  Â  Â  Â  Â  Authorization: `token ${token}`,
Â  Â  Â  Â  Â  Â  'Content-Type': 'application/json'
Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  body: JSON.stringify({
Â  Â  Â  Â  Â  Â  message: 'ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ Ñ„Ð°Ð¹Ð»Ð°',
Â  Â  Â  Â  Â  Â  content: encoded,
Â  Â  Â  Â  Â  Â  ...(sha ? { sha } : {})
Â  Â  Â  Â  Â  })
Â  Â  Â  Â  });


Â  Â  Â  Â  let result = await res.json();
Â  Â  Â  Â  if (result.commit) {
Â  Â  Â  Â  Â  alert('Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¾: ' + result.commit.message);
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  alert('ÐžÑˆÐ¸Ð±ÐºÐ°: ' + result.message);
Â  Â  Â  Â  }
Â  Â  Â  }
Â  Â  }}
Â  ]
});


document.body.appendChild(app);