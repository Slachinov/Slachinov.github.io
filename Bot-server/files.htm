<!DOCTYPE html>
<html lang="ru">
<head>
Â  <meta charset="UTF-8">
Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  <title>gihub files</title>
<script src="../js/qqv33.js"></script>
Â  </head>
<body>125
<script type='module'>alert(7);/*
alert(qq.ca);
qq.ca([{tag:'div',style:{top:'0px',left:'0px',right:'0px',bottom:'0px',background:'gray',position: 'absolute','z-index':5},name:'main'}]);*/




import { m, ls, gh, db } from '/Lib/pan/main.js';




Â  Â  Â  import { createFullscreenPanel } from '/Lib/pan/1all1.js';
Â  Â  Â Â 
Â  Â  Â  import { createEditButton } from '/aa/edit2.js';
Â  Â  Â  import { createTopBottomMiddleLayout } from '/Lib/pan/3pv2.js';




Â  Â  Â  const grayPanel = createFullscreenPanel({ tag: 'div', style: { background: 'gray' } });
Â  Â  Â  let mm = createTopBottomMiddleLayout(
Â  Â  Â  Â  grayPanel,
Â  Â  Â  Â  { style: { background: 'blue' } },
Â  Â  Â  Â  { style: { background: 'green' } },
Â  Â  Â  Â  { style: { background: 'red' } }
Â  Â  Â  );
Â  Â  Â  m.top = mm[0];
Â  Â  Â  m.blue = mm[0];
Â  Â  Â  m.red = mm[1];
Â  Â  Â  m.green = mm[2];




Â  Â  Â  qq.ce({ tag: 'button', it: 'tratata345', parent: mm[0] });
Â  Â  Â  qq.ce({ tag: 'button', it: 'tratata', parent: mm[1] });
//=========/==/====/


Â let inp=qq.ce({ tag: 'input', ns: 'filename', attr: { placeholder: 'Ğ˜Ğ¼Ñ Ñ„Ğ°Ğ¹Ğ»Ğ° (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€: files/test.txt)' }, style: { width: '100%', marginBottom: '0.5em' } ,parent:m.top});
//============â‰ˆ===
let repo='Slachinov/Bot-server';


Â qq.ce({ tag: 'button', it: 'ğŸ“– ĞŸÑ€Ğ¾Ñ‡Ğ¸Ñ‚Ğ°Ñ‚ÑŒ Ñ„Ğ°Ğ¹Ğ»', style: { marginBottom: '0.5em' }, parent:m.top,event: {
Â  Â  Â  click: async function () {
Â  Â  Â  Â  let path = inp.value.trim();
Â  Â  Â  Â  if (!path) return alert('Ğ£ĞºĞ°Ğ¶Ğ¸ Ğ¸Ğ¼Ñ Ñ„Ğ°Ğ¹Ğ»Ğ°');
Â  Â  Â  Â  let url = `https://api.github.com/repos/${repo}/contents/${path}`;




Â  Â  Â  Â  let res = await fetch(url, {
Â  Â  Â  Â  Â  headers: { Authorization: `token ${token}` }
Â  Â  Â  Â  });
Â  Â  Â  Â  let data = await res.json();
Â  Â  Â  Â  if (data.content) {
Â  Â  Â  Â  Â  let decoded = decodeURIComponent(escape(atob(data.content)));
Â  Â  Â  Â  Â  app.content.value = decoded;
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  alert('ĞÑˆĞ¸Ğ±ĞºĞ°: ' + data.message);
Â  Â  Â  Â  }
Â  Â  Â  }
Â  Â  }});


//==////====////
</script>
let token = localStorage.getItem('bot-token');
let repo = 'user/repo'; /* Ğ·Ğ°Ğ¼ĞµĞ½Ğ¸Ñ‚Ğµ Ğ½Ğ° ÑĞ²Ğ¾Ğ¹ repo, Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€: myname/myrepo */


let app = qq.ca('githubApp', {
Â  skin: [
Â  Â  { ns: 'githubApp', tag: 'div', style: { padding: '1em', fontFamily: 'sans-serif' } },


Â  Â  /* Ğ’Ğ²Ğ¾Ğ´ Ğ¿ÑƒÑ‚Ğ¸ */
Â  Â  { tag: 'input', ns: 'path', attr: { placeholder: 'ĞŸÑƒÑ‚ÑŒ (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€: files/)' }, prop: { value: 'files/' }, style: { width: '100%', marginBottom: '0.5em' } },


Â  Â  /* Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° ÑĞ¿Ğ¸ÑĞºĞ° Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ² */
Â  Â  { tag: 'button', ns: 'load', innerText: 'ğŸ“‚ Ğ—Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ ÑĞ¿Ğ¸ÑĞ¾Ğº Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²', style: { marginBottom: '1em' }, event: {
Â  Â  Â  tap: async function () {
Â  Â  Â  Â  let path = app.path.value.trim();
Â  Â  Â  Â  if (!path) return alert('Ğ£ĞºĞ°Ğ¶Ğ¸ Ğ¿ÑƒÑ‚ÑŒ');
Â  Â  Â  Â  let url = `https://api.github.com/repos/${repo}/contents/${path}`;


Â  Â  Â  Â  let res = await fetch(url, {
Â  Â  Â  Â  Â  headers: { Authorization: `token ${token}` }
Â  Â  Â  Â  });
Â  Â  Â  Â  let files = await res.json();


Â  Â  Â  Â  if (!Array.isArray(files)) return alert('Ğ­Ñ‚Ğ¾ Ğ½Ğµ Ğ¿Ğ°Ğ¿ĞºĞ° Ğ¸Ğ»Ğ¸ Ğ¾ÑˆĞ¸Ğ±ĞºĞ°');


Â  Â  Â  Â  app.list.innerHTML = '';
Â  Â  Â  Â  for (let file of files) {
Â  Â  Â  Â  Â  if (file.type === 'file') {
Â  Â  Â  Â  Â  Â  app.list.appendChild(qq.ce({
Â  Â  Â  Â  Â  Â  Â  tag: 'button', innerText: file.name, style: { display: 'block', margin: '2px 0' },
Â  Â  Â  Â  Â  Â  Â  event: {
Â  Â  Â  Â  Â  Â  Â  Â  tap: async () => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  let res2 = await fetch(file.download_url);
Â  Â  Â  Â  Â  Â  Â  Â  Â  let txt = await res2.text();
Â  Â  Â  Â  Â  Â  Â  Â  Â  app.filename.value = file.path;
Â  Â  Â  Â  Â  Â  Â  Â  Â  app.content.value = txt;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }));
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  }
Â  Â  }},


Â  Â  { tag: 'div', ns: 'list', style: { marginBottom: '1em' } },


Â  Â  /* Ğ˜Ğ¼Ñ Ñ„Ğ°Ğ¹Ğ»Ğ° */
Â  Â  { tag: 'input', ns: 'filename', attr: { placeholder: 'Ğ˜Ğ¼Ñ Ñ„Ğ°Ğ¹Ğ»Ğ° (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€: files/test.txt)' }, style: { width: '100%', marginBottom: '0.5em' } },


Â  Â  /* Ğ§Ñ‚ĞµĞ½Ğ¸Ğµ Ñ„Ğ°Ğ¹Ğ»Ğ° */
Â  Â  { tag: 'button', innerText: 'ğŸ“– ĞŸÑ€Ğ¾Ñ‡Ğ¸Ñ‚Ğ°Ñ‚ÑŒ Ñ„Ğ°Ğ¹Ğ»', style: { marginBottom: '0.5em' }, event: {
Â  Â  Â  tap: async function () {
Â  Â  Â  Â  let path = app.filename.value.trim();
Â  Â  Â  Â  if (!path) return alert('Ğ£ĞºĞ°Ğ¶Ğ¸ Ğ¸Ğ¼Ñ Ñ„Ğ°Ğ¹Ğ»Ğ°');
Â  Â  Â  Â  let url = `https://api.github.com/repos/${repo}/contents/${path}`;


Â  Â  Â  Â  let res = await fetch(url, {
Â  Â  Â  Â  Â  headers: { Authorization: `token ${token}` }
Â  Â  Â  Â  });
Â  Â  Â  Â  let data = await res.json();
Â  Â  Â  Â  if (data.content) {
Â  Â  Â  Â  Â  let decoded = decodeURIComponent(escape(atob(data.content)));
Â  Â  Â  Â  Â  app.content.value = decoded;
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  alert('ĞÑˆĞ¸Ğ±ĞºĞ°: ' + data.message);
Â  Â  Â  Â  }
Â  Â  Â  }
Â  Â  }},


Â  Â  /* ĞšĞ¾Ğ½Ñ‚ĞµĞ½Ñ‚ Ñ„Ğ°Ğ¹Ğ»Ğ° */
Â  Â  { tag: 'textarea', ns: 'content', attr: { placeholder: 'Ğ¡Ğ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ğ¼Ğ¾Ğµ Ñ„Ğ°Ğ¹Ğ»Ğ°...' }, style: { width: '100%', height: '150px', marginBottom: '0.5em' } },


Â  Â  /* Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ñ„Ğ°Ğ¹Ğ»Ğ° */
Â  Â  { tag: 'button', innerText: 'ğŸ’¾ Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ Ñ„Ğ°Ğ¹Ğ»', event: {
Â  Â  Â  tap: async function () {
Â  Â  Â  Â  let path = app.filename.value.trim();
Â  Â  Â  Â  let content = app.content.value;
Â  Â  Â  Â  if (!path) return alert('Ğ£ĞºĞ°Ğ¶Ğ¸ Ğ¸Ğ¼Ñ Ñ„Ğ°Ğ¹Ğ»Ğ°');


Â  Â  Â  Â  let getSha = async () => {
Â  Â  Â  Â  Â  let res = await fetch(`https://api.github.com/repos/${repo}/contents/${path}`, {
Â  Â  Â  Â  Â  Â  headers: { Authorization: `token ${token}` }
Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  let data = await res.json();
Â  Â  Â  Â  Â  return data.sha || undefined;
Â  Â  Â  Â  };


Â  Â  Â  Â  let sha = await getSha();
Â  Â  Â  Â  let encoded = btoa(unescape(encodeURIComponent(content)));


Â  Â  Â  Â  let res = await fetch(`https://api.github.com/repos/${repo}/contents/${path}`, {
Â  Â  Â  Â  Â  method: 'PUT',
Â  Â  Â  Â  Â  headers: {
Â  Â  Â  Â  Â  Â  Authorization: `token ${token}`,
Â  Â  Â  Â  Â  Â  'Content-Type': 'application/json'
Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  body: JSON.stringify({
Â  Â  Â  Â  Â  Â  message: 'ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ñ„Ğ°Ğ¹Ğ»Ğ°',
Â  Â  Â  Â  Â  Â  content: encoded,
Â  Â  Â  Â  Â  Â  ...(sha ? { sha } : {})
Â  Â  Â  Â  Â  })
Â  Â  Â  Â  });


Â  Â  Â  Â  let result = await res.json();
Â  Â  Â  Â  if (result.commit) {
Â  Â  Â  Â  Â  alert('Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¾: ' + result.commit.message);
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  alert('ĞÑˆĞ¸Ğ±ĞºĞ°: ' + result.message);
Â  Â  Â  Â  }
Â  Â  Â  }
Â  Â  }}
Â  ]
});


document.body.appendChild(app);